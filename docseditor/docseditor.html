<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Docs Editor</title>
    <link rel="stylesheet" href="docseditor.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <link rel="icon" href="images/logo.png" type="image/png">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Libraries for document export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
    <script src="../shared/export-utils.js"></script>
    <script>
        // Check authentication before loading the page
        const authToken = localStorage.getItem('authToken');
        const user = localStorage.getItem('user');
        if (!authToken || !user) {
            window.location.href = '../auth/login.html';
        }
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 class="app-title">
                    <i class="fas fa-file-alt"></i>
                    Web Docs Editor
                </h1>
            </div>
            <div class="header-center">
                <input type="text" id="document-title" class="document-title" placeholder="Untitled Document" value="Untitled Document">
            </div>
            <div class="header-right">
                <button class="btn btn-info" id="dashboard-btn">
                    <i class="fas fa-th-large"></i>
                    Dashboard
                </button>
                <button class="btn btn-primary" id="save-btn">
                    <i class="fas fa-save"></i>
                    Save
                </button>
                <div class="export-dropdown">
                    <button class="btn btn-secondary" id="export-btn">
                        <i class="fas fa-download"></i>
                        Export
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="export-menu" id="export-menu">
                        <button class="export-option" id="export-html">
                            <i class="fas fa-code"></i>
                            HTML
                        </button>
                        <button class="export-option" id="export-pdf">
                            <i class="fas fa-file-pdf"></i>
                            PDF
                        </button>
                        <button class="export-option" id="export-docx">
                            <i class="fas fa-file-word"></i>
                            DOCX
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Toolbar -->
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="toolbar-btn" id="undo-btn" title="Undo">
                    <i class="fas fa-undo"></i>
                </button>
                <button class="toolbar-btn" id="redo-btn" title="Redo">
                    <i class="fas fa-redo"></i>
                </button>
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <select class="font-family-select" id="font-family">
                    <option value="Arial">Arial</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Verdana">Verdana</option>
                </select>
                <select class="font-size-select" id="font-size">
                    <option value="12">12</option>
                    <option value="14" selected>14</option>
                    <option value="16">16</option>
                    <option value="18">18</option>
                    <option value="20">20</option>
                    <option value="24">24</option>
                    <option value="28">28</option>
                    <option value="32">32</option>
                </select>
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <button class="toolbar-btn" id="bold-btn" title="Bold">
                    <i class="fas fa-bold"></i>
                </button>
                <button class="toolbar-btn" id="italic-btn" title="Italic">
                    <i class="fas fa-italic"></i>
                </button>
                <button class="toolbar-btn" id="underline-btn" title="Underline">
                    <i class="fas fa-underline"></i>
                </button>
                <button class="toolbar-btn" id="strikethrough-btn" title="Strikethrough">
                    <i class="fas fa-strikethrough"></i>
                </button>
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <button class="toolbar-btn" id="align-left-btn" title="Align Left">
                    <i class="fas fa-align-left"></i>
                </button>
                <button class="toolbar-btn" id="align-center-btn" title="Align Center">
                    <i class="fas fa-align-center"></i>
                </button>
                <button class="toolbar-btn" id="align-right-btn" title="Align Right">
                    <i class="fas fa-align-right"></i>
                </button>
                <button class="toolbar-btn" id="align-justify-btn" title="Justify">
                    <i class="fas fa-align-justify"></i>
                </button>
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <button class="toolbar-btn" id="bullet-list-btn" title="Bullet List">
                    <i class="fas fa-list-ul"></i>
                </button>
                <button class="toolbar-btn" id="number-list-btn" title="Numbered List">
                    <i class="fas fa-list-ol"></i>
                </button>
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <input type="color" id="text-color" class="color-picker" title="Text Color">
                <input type="color" id="bg-color" class="color-picker" title="Background Color">
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <button class="toolbar-btn" id="link-btn" title="Insert Link">
                    <i class="fas fa-link"></i>
                </button>
                <button class="toolbar-btn" id="image-btn" title="Insert Image">
                    <i class="fas fa-image"></i>
                </button>
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <button class="toolbar-btn" id="watermark-btn" title="Add Watermark">
                    <i class="fas fa-tint"></i>
                </button>
                <!-- Single toggle button handles add/remove watermark -->
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <button class="toolbar-btn" id="version-control-btn" title="Version Control">
                    <i class="fas fa-code-branch"></i>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="document-area">
                <div class="document-container" id="document-container">
                    <div class="editor" id="editor" contenteditable="true" spellcheck="true">
                        <p>Start typing your document here...</p>
                    </div>
                    <div class="page-indicators" id="page-indicators">
                        <!-- Visual page indicators will be added here -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span id="word-count">Words: 0</span>
                <span id="char-count">Characters: 0</span>
                <span id="page-count">Pages: 1</span>
                <span id="current-page">Page: 1</span>
            </div>
            <div class="status-right">
                <span id="last-saved">Never saved</span>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <div id="link-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Insert Link</h3>
            <input type="text" id="link-text" placeholder="Link text">
            <input type="url" id="link-url" placeholder="https://example.com">
            <div class="modal-actions">
                <button class="btn btn-primary" id="insert-link-btn">Insert</button>
                <button class="btn btn-secondary" id="cancel-link-btn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="image-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Insert Image</h3>
            
            <div class="modal-body">
                <!-- Image Source Tabs -->
                <div class="image-tabs">
                    <button class="tab-btn active" id="url-tab">From URL</button>
                    <button class="tab-btn" id="upload-tab">Upload File</button>
                </div>
                
                <!-- URL Tab Content -->
                <div class="tab-content active" id="url-content">
                    <div class="form-group">
                        <label for="image-url">Image URL:</label>
                        <input type="url" id="image-url" placeholder="https://example.com/image.jpg">
                    </div>
                </div>
                
                <!-- Upload Tab Content -->
                <div class="tab-content" id="upload-content">
                    <div class="form-group">
                        <label for="image-file">Choose Image File:</label>
                        <input type="file" id="image-file" accept="image/*" class="file-input">
                        <div class="file-drop-zone" id="file-drop-zone">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Drag & drop an image here or click to browse</p>
                            <p class="file-info">Supports: JPG, PNG, GIF, WebP</p>
                        </div>
                    </div>
                    
                    <!-- Image Preview -->
                    <div class="image-preview" id="image-preview" style="display: none;">
                        <img id="preview-img" src="" alt="Preview">
                        <div class="preview-info">
                            <span id="file-name"></span>
                            <span id="file-size"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Common Fields -->
                <div class="form-group">
                    <label for="image-alt">Alt Text (Description):</label>
                    <input type="text" id="image-alt" placeholder="Describe the image for accessibility">
                </div>
                
                <div class="form-group">
                    <label for="image-width">Width (optional):</label>
                    <input type="number" id="image-width" placeholder="Auto" min="50" max="1000">
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-primary" id="insert-image-btn">Insert</button>
                <button class="btn btn-secondary" id="cancel-image-btn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="watermark-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Add Watermark</h3>
            <input type="text" id="watermark-text" placeholder="Enter watermark text">
            <div class="form-group">
                <label for="watermark-opacity">Opacity:</label>
                <input type="range" id="watermark-opacity" min="0.1" max="0.5" step="0.05" value="0.2">
                <span id="opacity-value">0.2</span>
            </div>
            <div class="form-group">
                <label for="watermark-size">Size:</label>
                <select id="watermark-size">
                    <option value="small">Small</option>
                    <option value="medium" selected>Medium</option>
                    <option value="large">Large</option>
                </select>
            </div>
            <div class="form-group">
                <label for="watermark-color">Color:</label>
                <input type="color" id="watermark-color" value="#cccccc">
            </div>
            <div class="form-group">
                <label for="watermark-angle">Angle:</label>
                <input type="range" id="watermark-angle" min="-45" max="45" step="5" value="-30">
                <span id="angle-value">-30°</span>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" id="apply-watermark-btn">Apply</button>
                <button class="btn btn-secondary" id="remove-watermark-btn">Remove</button>
                <button class="btn btn-secondary" id="cancel-watermark-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Custom Context Menu -->
    <div id="custom-context-menu" class="custom-context-menu">
        <div class="context-menu-item" id="context-cut">
            <i class="fas fa-cut"></i>
            <span>Cut</span>
        </div>
        <div class="context-menu-item" id="context-copy">
            <i class="fas fa-copy"></i>
            <span>Copy</span>
        </div>
        <div class="context-menu-item" id="context-paste">
            <i class="fas fa-paste"></i>
            <span>Paste</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="context-select-all">
            <i class="fas fa-check-square"></i>
            <span>Select All</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="context-bold">
            <i class="fas fa-bold"></i>
            <span>Bold</span>
        </div>
        <div class="context-menu-item" id="context-italic">
            <i class="fas fa-italic"></i>
            <span>Italic</span>
        </div>
        <div class="context-menu-item" id="context-underline">
            <i class="fas fa-underline"></i>
            <span>Underline</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="context-insert-link">
            <i class="fas fa-link"></i>
            <span>Insert Link</span>
        </div>
        <div class="context-menu-item" id="context-insert-image">
            <i class="fas fa-image"></i>
            <span>Insert Image</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="context-word-count">
            <i class="fas fa-calculator"></i>
            <span>Word Count</span>
        </div>
        <div class="context-menu-item" id="context-save">
            <i class="fas fa-save"></i>
            <span>Save Document</span>
        </div>
    </div>

    <script src="../shared/api-client.js"></script>
    <script src="docseditor.js"></script>
</body>
</html>
